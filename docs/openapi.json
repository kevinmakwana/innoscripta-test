
{
	"openapi": "3.0.0",
	"info": {
		"title": "News Aggregator API",
		"version": "1.0.0",
		"description": "Expanded spec with security schemes"
	},
	"servers": [
		{ "url": "/api/v1", "description": "Local API v1" }
	],
	"components": {
		"securitySchemes": {
			"BearerAuth": {
				"type": "http",
				"scheme": "bearer",
				"bearerFormat": "JWT",
				"description": "Use an Authorization: Bearer <token> header for API access (token generated by the auth endpoints)."
			},
			"SanctumCookie": {
				"type": "apiKey",
				"in": "cookie",
				"name": "laravel_session",
				"description": "Laravel Sanctum cookie-based session authentication (for SPA)."
			}
		},
		"schemas": {
			"PaginatedArticles": {
				"type": "object",
				"properties": {
					"data": { "type": "array", "items": { "$ref": "#/components/schemas/Article" } },
					"meta": { "type": "object" }
				}
			},
			"Article": {
				"type": "object",
				"properties": { "id": { "type": "integer" }, "title": { "type": "string" } }
			},
			"UserPreferenceInput": {
				"type": "object",
				"properties": {
					"sources": { "type": "array", "items": { "type": "integer" } },
					"categories": { "type": "array", "items": { "type": "string" } }
				}
			},
			"UserPreferenceResource": {
				"type": "object",
				"properties": { "data": { "$ref": "#/components/schemas/UserPreferenceInput" } }
			},
			"ValidationError": {
				"type": "object",
				"properties": { "message": { "type": "string" }, "errors": { "type": "object" } }
			},
			"Error": {
				"type": "object",
				"properties": { "code": { "type": "integer" }, "message": { "type": "string" } }
			}
		}
	},
	"paths": {
			"/authors": {
				"get": {
					"summary": "List authors",
					"parameters": [
						{ "in": "query", "name": "per_page", "schema": { "type": "integer" }, "description": "Pagination size" }
					],
					"responses": {
						"200": {
							"description": "A paginated list of authors",
							"content": {
								"application/json": {
									"schema": { "type": "object", "properties": { "data": { "type": "array", "items": { "$ref": "#/components/schemas/Author" } } } }
								}
							}
						}
					}
				}
			},
			"/authors/{id}": {
				"get": {
					"summary": "Get author",
					"parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
					"responses": {
						"200": { "description": "Author resource", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Author" } } } },
						"404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Error" } } } }
					}
				}
			},
		"/articles": {
			"get": {
				"summary": "List articles",
				"responses": {
					"200": {
						"description": "A paginated list",
						"content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedArticles" } } }
					}
				}
			}
		},
		"/preferences": {
			"get": {
				"summary": "Get user preferences",
				"security": [ { "SanctumCookie": [] }, { "BearerAuth": [] } ],
				"responses": {
					"200": {
						"description": "Preferences",
						"content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserPreferenceResource" } } }
					},
					"401": {
						"description": "Unauthorized",
						"content": { "application/json": { "schema": { "$ref": "#/components/schemas/Error" } } }
					}
				}
			},
			"post": {
				"summary": "Create or replace preferences",
				"security": [ { "SanctumCookie": [] }, { "BearerAuth": [] } ],
				"requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserPreferenceInput" } } } },
				"responses": {
					"201": {
						"description": "Created",
						"content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserPreferenceResource" } } }
					},
					"400": {
						"description": "Validation error",
						"content": { "application/json": { "schema": { "$ref": "#/components/schemas/ValidationError" } } }
					},
					"401": {
						"description": "Unauthorized",
						"content": { "application/json": { "schema": { "$ref": "#/components/schemas/Error" } } }
					}
				}
			}
		}
	}
}
